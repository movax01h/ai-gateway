<critical_execution_requirement>
YOU MUST MAKE EXACTLY TWO TOOL CALLS IN YOUR RESPONSE:
1. run_git_command (to push the branch)
2. create_merge_request (to create the MR)

DO NOT make only one tool call. DO NOT wait for the first to complete.
BOTH calls must be in the SAME response or the workflow will fail.
</critical_execution_requirement>

<instructions>
<step number="1" name="parse_vulnerability_data">
Parse vulnerability_details JSON to extract:
- vulnerability.id (required - may be in GID format like "gid://gitlab/Vulnerability/12345")
    If vulnerability.id is in GID format (contains "gid://gitlab/Vulnerability/"): Extract ONLY the numeric ID at the end (e.g., "gid://gitlab/Vulnerability/12345" â†’ "12345")
- vulnerability.reportType (required)
- vulnerability.title (optional)
- vulnerability.description (optional)
</step>

<step number="2" name="construct_branch_name">
Branch name: security/sast-fix-<vulnerability_id>-<workflow_id>
Example: "security/sast-fix-4313-360"
</step>

<step number="3" name="FIRST_TOOL_CALL_push_branch">
FIRST TOOL CALL - run_git_command:

run_git_command(
    repository_url="<repository_url>",
    command="push",
    args="-u origin HEAD:refs/heads/<branch_name>"
)

Example:
run_git_command(
    repository_url="http://gdk.test:3000/gitlab-duo/project.git",
    command="push",
    args="-u origin HEAD:refs/heads/security/sast-fix-4313-360"
)
</step>

<step number="4" name="construct_mr_metadata">
MR Title: fix(security): Resolve <TYPE> vulnerability #<ID>

MR Description:
## Security Fix: <vulnerability type>

Addresses vulnerability #<vulnerability_id> detected by SAST.

**Vulnerability Details:**
- ID: [vulnerability:<numeric_id_only>]
- Type: <vulnerability.reportType>
- Severity: <severity if available>

**Changes Made:**
<Brief summary of fix from fix_summary>

---
*Generated by GitLab Duo Workflow (ID: <workflow_id>)*
</step>

<step number="5" name="SECOND_TOOL_CALL_create_mr">
SECOND TOOL CALL - create_merge_request:

create_merge_request(
    project_id=<project_id>,
    source_branch="<branch_name from step 2>",
    target_branch="{{default_branch}}",
    title="<title from step 4>",
    description="<description from step 4>",
    remove_source_branch=true
)

IMPORTANT - Target Branch Selection:
- First try "main" as the target
- If you have information suggesting the project uses a different default branch (like "master" or "develop"), use that instead
- The source_branch is the NEW branch you're creating (from step 2)
- The target_branch is where you want to merge INTO (the project's default branch)

DO NOT include a "labels" parameter.
Use the default_branch value provided in the context: {{default_branch}}
</step>
</instructions>

<execution_requirements>
1. Make BOTH tool calls in the SAME response
2. First call: run_git_command (push)
3. Second call: create_merge_request
4. The push must happen before the MR creation
5. Do NOT include "labels" parameter in create_merge_request
</execution_requirements>
