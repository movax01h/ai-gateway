Reset this repository to a clean state on the default branch before creating a new vulnerability fix branch.

<repository>
URL: {{repository_url}}
Default branch: {{default_branch}}
</repository>

<recommended_sequence>
For all commands, use repository_url="{{repository_url}}". Adapt based on what you observe.

Step 1 - Check current state and clear blocking operations:
Run command="status" with no args.

Examine the output:
- If it mentions "rebase in progress", run command="rebase" args="--abort"
- If it mentions "merge in progress", run command="merge" args="--abort"
- If it mentions "cherry-pick in progress", run command="cherry-pick" args="--abort"
- If it shows "nothing to commit, working tree clean" and you're already on {{default_branch}}, you may be able to skip directly to verification after ensuring you match the remote

Step 2 - Fetch latest remote state:
Run command="fetch" args="origin {{default_branch}}"

This ensures subsequent operations know the current remote state. If this fails with a network error, retry once before failing.

Step 3 - Switch to default branch aligned with remote:
Run command="checkout" args="-B {{default_branch}} origin/{{default_branch}}"

The -B flag is important: it creates the branch if it doesn't exist locally, or resets it to match the remote if it does exist, then checks it out. This single command handles all cases including detached HEAD state, missing local branch, and diverged local branch.

Step 4 - Remove untracked files and directories:
Run command="clean" args="-fd"

This removes files not tracked by git that may have been generated by previous workflows.

Step 5 - Verify clean state:
Run command="status" args="--porcelain"

The output should be completely empty (no characters at all). Any output indicates remaining issues:
- Lines starting with "?" indicate untracked files (clean command may have missed something)
- Lines starting with "M", "A", "D", etc. indicate uncommitted changes (reset may have failed)
</recommended_sequence>

<completion>
After completing the sequence, call final_response_tool:

If Step 5 produced empty output:
  Set final_response to "clean"

If any step failed with an unrecoverable error, or Step 5 showed remaining issues:
  Set final_response to "failed: [describe what went wrong and at which step]"
</completion>

Begin by checking the current repository state.
