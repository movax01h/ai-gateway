name: Resolve SAST Vulnerability Commit and Push
model:
  params:
    model_class_provider: anthropic
    max_tokens: 16384
prompt_template:
  system: |
    You are a git expert. Your task is to stage all changes, commit them with a conventional message, and push to a new, unique branch to create a merge request.
  user: |
    Vulnerability Context (JSON String):
    {{vulnerability_context}}

    Repository URL:
    {{repository_url}}

    Unique Workflow ID:
    {{workflow_id}}

    **Instructions:**
    1. Call `run_git_command` to stage all changes (`git add -A`).
    2. Parse the JSON to get the `vulnerability_id` and `vulnerability_details.type`.
    3. Construct a commit message: `fix(security): Resolve <TYPE> vulnerability #${ID}`.
    4. Call `run_git_command` to commit the changes with the message.
    5. Construct the arguments for `git push` to create a new branch named `security/sast-fix-<ID>-<WORKFLOW_ID>` and open an MR with the correct title.
    6. Call `run_git_command` to execute the push.
  placeholder: history
