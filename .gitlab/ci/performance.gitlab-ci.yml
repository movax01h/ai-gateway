dotenv-vars:
  stage: test
  script:
    - echo "JOB_WITH_ARTIFACTS=$CI_JOB_NAME" >> variables.env
    - echo "JOB_WITH_ARTIFACTS_ID=$CI_JOB_ID" >> variables.env
    - echo $JOB_WITH_ARTIFACTS
    - echo $JOB_WITH_ARTIFACTS_ID
    - cat variables.env
  artifacts:
    paths:
      - performance_tests
      - variables.env
    expire_in: 1 hour
    reports:
      dotenv: variables.env

tests:performance:
  stage: test
  needs:
    - job: dotenv-vars
      artifacts: true
  trigger:
    project: gitlab-org/quality/component-performance-testing
    branch: main
    strategy: depend
    forward:
      pipeline_variables: true
      yaml_variables: true
  variables:
    JOB_WITH_ARTIFACTS: $JOB_WITH_ARTIFACTS
    JOB_WITH_ARTIFACTS_ID: $JOB_WITH_ARTIFACTS_ID
    PROJECT_ID: $CI_PROJECT_ID
    COMPONENT_MR_CI_COMMIT_SHA: $CI_COMMIT_SHORT_SHA
    PARENT_PIPELINE_MR_IID: $CI_MERGE_REQUEST_IID
