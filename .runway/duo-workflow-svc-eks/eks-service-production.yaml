apiVersion: runway/v1
kind: RunwayKubernetesDeployment

duo-workflow-svc-eks:
  metadata:
    labels:
      gitlab.com/department: eng-dev
      gitlab.com/department_group: eng-dev-create-shared-infra
      gitlab.com/product_category: duo_agent_platform
      gitlab.com/owner_email_handle: bastirehm

  serviceMixins:
    - "runway-eks.service-mixin"

  spec:
    environment:
      DUO_WORKFLOW_AUTH__OIDC_GITLAB_URL: "https://gitlab.com/"
      DUO_WORKFLOW_AUTH__OIDC_CUSTOMER_PORTAL_URL: "https://customers.gitlab.com"
      DUO_WORKFLOW_GOOGLE_CLOUD_PROFILER__ENABLED: "false"
      LANGSMITH_PROJECT: "duo-workflow-production"
      DUO_WORKFLOW_SERVICE_ENVIRONMENT: "production"
      DUO_WORKFLOW_DIRECT_CONNECTION_BASE_URL: "https://gitlab.com"
      AIGW_GOOGLE_CLOUD_PLATFORM__PROJECT: "gitlab-ai-framework-prod"

  workloadSecrets:
    - name: env-vars
    - name: gcp-service-account

  secretEnvFrom:
    - env-vars

  secretVolumes:
    - name: gcp-service-account
      path: /secrets/gcp-service-account
